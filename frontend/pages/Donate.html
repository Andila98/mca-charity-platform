<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Make a Donation - Charity Platform</title>
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/layout.css">
    <link rel="stylesheet" href="../css/components.css">
    <link rel="stylesheet" href="../css/admin.css">
    <link rel="stylesheet" href="../css/image-management.css">
    <link rel="stylesheet" href="../css/responsive.css">
    <link rel="stylesheet" href="../css/pages/donate.css">
</head>
<body>

    <!-- ============================================================
    ADMIN BAR
    ============================================================ -->
    <div class="admin-bar" id="adminBar">
        <div class="admin-bar-content">
            <span>üìù Admin Mode Active</span>
            <small>Click any text to edit ‚Ä¢ Ctrl+Shift+A to toggle</small>
        </div>
        <div>
            <button onclick="savePageChanges()" class="admin-btn save-btn">
                üíæ Save Changes
            </button>
            <button onclick="openImageUploadModal()" class="btn-upload-image">
                üì∏ Upload Image
            </button>
            <button onclick="adminLogout()" class="admin-btn logout-btn">
                üö™ Logout
            </button>
        </div>
    </div>

    <!-- ============================================================
    LOGIN MODAL
    ============================================================ -->
    <div class="modal" id="adminLoginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üîê Admin Login</h2>
                <button class="close-btn" onclick="closeAdminLogin()">&times;</button>
            </div>
            <div class="error-message" id="adminErrorMessage"></div>
            <form id="adminLoginForm">
                <div class="form-group">
                    <label for="adminUsername">Username</label>
                    <input type="text" id="adminUsername" name="username" placeholder="Enter admin username" autocomplete="username" required>
                </div>
                <div class="form-group">
                    <label for="adminPassword">Password</label>
                    <input type="password" id="adminPassword" name="password" placeholder="Enter admin password" autocomplete="current-password" required>
                </div>
                <div class="modal-buttons">
                    <button type="submit" class="btn-login" id="adminLoginSubmit">üîì Login</button>
                    <button type="button" class="btn-cancel" onclick="closeAdminLogin()">Cancel</button>
                </div>
            </form>
            <div class="modal-footer">
                <small>Keyboard shortcut: Ctrl+Shift+A</small>
            </div>
        </div>
    </div>

    <!-- ============================================================
    INLINE EDITOR
    ============================================================ -->
    <div class="inline-editor" id="inlineEditor">
        <textarea id="editorContent" placeholder="Edit content here..."></textarea>
        <div class="inline-editor-buttons">
            <button class="save-btn" onclick="saveInlineEdit()">‚úÖ Save</button>
            <button class="cancel-btn" onclick="cancelInlineEdit()">‚ùå Cancel</button>
        </div>
    </div>

    <!-- ============================================================
    IMAGE UPLOAD MODAL
    ============================================================ -->
    <div class="modal" id="imageUploadModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üì∏ Upload Image</h2>
                <button class="close-btn" onclick="closeImageUploadModal()">&times;</button>
            </div>
            <div class="image-dropzone" id="imageDropZone">
                <div class="dropzone-content">
                    <div class="dropzone-icon">üìÅ</div>
                    <h3>Drag image here or click to browse</h3>
                    <p>Supported: JPG, PNG, GIF, WebP (Max 5MB)</p>
                </div>
                <input type="file" id="imageFileInput" accept="image/jpeg,image/png,image/gif,image/webp" style="display: none;">
            </div>
            <div class="file-info" id="fileInfoBox" style="display: none;">
                <div class="file-preview">
                    <div class="file-icon">üñºÔ∏è</div>
                    <div class="file-details">
                        <p><strong>File:</strong> <span id="imageFileName">-</span></p>
                        <p><strong>Size:</strong> <span id="imageFileSize">-</span></p>
                    </div>
                </div>
            </div>
            <div class="image-config-form">
                <div class="form-group">
                    <label for="imageKeyInput">Image Key *</label>
                    <input type="text" id="imageKeyInput" placeholder="e.g., hero-image, about-banner" required>
                    <small>Unique identifier for this image (use lowercase, hyphens ok)</small>
                </div>
                <div class="form-group">
                    <label for="imageAltTextInput">Alt Text (Accessibility)</label>
                    <textarea id="imageAltTextInput" placeholder="Describe what the image shows..." rows="2"></textarea>
                    <small>Important for screen readers and SEO</small>
                </div>
                <div class="form-group">
                    <label for="imageDescriptionInput">Description</label>
                    <textarea id="imageDescriptionInput" placeholder="What is this image used for?" rows="2"></textarea>
                </div>
                <div class="progress-bar" id="uploadProgressBar" style="display: none;">
                    <div class="progress-fill" id="uploadProgressFill"></div>
                </div>
                <p class="progress-text" id="uploadProgressText"></p>
            </div>
            <div class="success-message" id="uploadSuccessMessage" style="display: none;">
                ‚úÖ Image uploaded successfully!
            </div>
            <div class="modal-buttons">
                <button onclick="confirmImageUpload()" class="btn-upload">‚¨ÜÔ∏è Upload</button>
                <button onclick="closeImageUploadModal()" class="btn-cancel">Cancel</button>
            </div>
        </div>
    </div>

    <!-- ============================================================
    IMAGE GALLERY
    ============================================================ -->
    <div class="image-gallery-container" style="display: none;">
        <div class="gallery-header">
            <h3>üì∏ Page Images</h3>
            <div class="gallery-stats">
                <span id="imageCount">0 images</span>
                <span id="storageUsage">0 MB used</span>
            </div>
        </div>
        <div class="image-gallery" id="imageGallery">
            <p class="loading">Loading images...</p>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="logo" onclick="location.href='../index.html'" style="cursor: pointer;">üè• Ajelo Foundation</div>
            <nav class="nav">
                <a href="../index.html">Home</a>
                <a href="about-us.html">About us</a>
                <a href="impact.html">Impact</a>
                <a href="get-involved.html">Get Involved</a>
                <a href="events.html">Events</a>
                <a href="volunteer.html">Volunteer</a>
                <a href="donate.html" class="btn btn-primary">Donate Now</a>

                <!-- Admin link -->
                <a href="#" id="adminLink" class="admin-link visible" onclick="openAdminLogin(); return false;">‚öôÔ∏è Admin</a>
                <button class="logout-btn" id="adminLogoutBtn" onclick="adminLogout()">üö™ Logout</button>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <h1 class="editable" data-key="donate-hero-title">Make a Difference</h1>
            <p class="editable" data-key="donate-hero-subtitle">Your donation helps us create lasting impact in our communities</p>
        </div>
    </section>

    <!-- Donation Form Section -->
    <section class="form-section">
        <div class="container">
            <div class="form-card">
                <h2 class="editable" data-key="donate-form-title">Donation Form</h2>
                <p class="form-description editable" data-key="donate-form-desc">Choose how you'd like to contribute</p>

                <form id="donation-form">
                    <!-- Donation Type -->
                    <div class="form-group">
                        <label>Donation Type <span class="required">*</span></label>
                        <div class="radio-group">
                            <div class="radio-wrapper">
                                <input type="radio" id="type-cash" name="donationType" value="CASH" checked>
                                <label for="type-cash">
                                    <span class="radio-icon">üíµ</span>
                                    <span>Cash Donation</span>
                                </label>
                            </div>
                            <div class="radio-wrapper">
                                <input type="radio" id="type-item" name="donationType" value="ITEM">
                                <label for="type-item">
                                    <span class="radio-icon">üì¶</span>
                                    <span>Item Donation</span>
                                </label>
                            </div>
                            <div class="radio-wrapper">
                                <input type="radio" id="type-service" name="donationType" value="SERVICE">
                                <label for="type-service">
                                    <span class="radio-icon">ü§ù</span>
                                    <span>Service Donation</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Cash Amount (shown only for CASH) -->
                    <div class="form-group" id="amount-group">
                        <label for="amount">Amount (KES) <span class="required">*</span></label>
                        <input
                                type="number"
                                id="amount"
                                name="amount"
                                class="form-control"
                                placeholder="Enter amount in KES"
                                min="1"
                                step="0.01"
                        >
                        <div class="error-message"></div>
                    </div>

                    <!-- Item Description (shown only for ITEM) -->
                    <div class="form-group hidden" id="item-group">
                        <label for="itemDescription">Item Description <span class="required">*</span></label>
                        <textarea
                                id="itemDescription"
                                name="itemDescription"
                                class="form-control"
                                rows="3"
                                placeholder="Describe the item(s) you're donating..."
                        ></textarea>
                        <div class="error-message"></div>
                    </div>

                    <!-- Service Description (shown only for SERVICE) -->
                    <div class="form-group hidden" id="service-group">
                        <label for="serviceDescription">Service Description <span class="required">*</span></label>
                        <textarea
                                id="serviceDescription"
                                name="serviceDescription"
                                class="form-control"
                                rows="3"
                                placeholder="Describe the service you're offering..."
                        ></textarea>
                        <div class="error-message"></div>
                    </div>

                    <!-- Project Selection (Optional) -->
                    <div class="form-group">
                        <label for="project">Select Project (Optional)</label>
                        <select id="project" name="project" class="form-control">
                            <option value="">General Donation (Not specific to any project)</option>
                        </select>
                        <small class="form-help">Leave blank for general donation</small>
                    </div>

                    <!-- Donor Information -->
                    <h3 class="section-title">Your Information</h3>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="donorName">Full Name <span class="required">*</span></label>
                            <input
                                    type="text"
                                    id="donorName"
                                    name="donorName"
                                    class="form-control"
                                    placeholder="Enter your full name"
                                    required
                            >
                            <div class="error-message"></div>
                        </div>

                        <div class="form-group">
                            <label for="donorEmail">Email Address <span class="required">*</span></label>
                            <input
                                    type="email"
                                    id="donorEmail"
                                    name="donorEmail"
                                    class="form-control"
                                    placeholder="your.email@example.com"
                                    required
                            >
                            <div class="error-message"></div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="donorPhone">Phone Number <span class="required">*</span></label>
                            <input
                                    type="tel"
                                    id="donorPhone"
                                    name="donorPhone"
                                    class="form-control"
                                    placeholder="0712345678"
                                    required
                            >
                            <div class="error-message"></div>
                        </div>

                        <div class="form-group">
                            <label for="donorWard">Ward/Location</label>
                            <select id="donorWard" name="donorWard" class="form-control">
                                <option value="">Select your ward</option>
                                <option value="Angurai North">Angurai North</option>
                                <option value="Angurai South">Angurai South</option>
                                <option value="Malaba Central">Malaba Central</option>
                                <option value="Malaba North">Malaba North</option>
                                <option value="Malaba South">Malaba South</option>
                            </select>
                        </div>
                    </div>

                    <!-- Additional Notes -->
                    <div class="form-group">
                        <label for="notes">Additional Notes (Optional)</label>
                        <textarea
                                id="notes"
                                name="notes"
                                class="form-control"
                                rows="3"
                                placeholder="Any additional information..."
                        ></textarea>
                    </div>

                    <!-- Submit Button -->
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary btn-large" id="submit-btn">
                            Submit Donation
                        </button>
                    </div>
                </form>
            </div>

            <!-- Success Message (hidden initially) -->
            <div id="success-card" class="success-card" style="display: none;">
                <div class="success-icon">‚úì</div>
                <h3>Donation Submitted!</h3>
                <p id="success-message">Thank you for your generous donation!</p>
                <button class="btn btn-primary" onclick="location.reload()">Make Another Donation</button>
                <a href="../index.html" class="btn btn-secondary">Back to Home</a>
            </div>
        </div>
    </section>

    <!-- Impact Stats Section -->
    <section class="impact-section">
        <div class="container">
            <h2 class="editable" data-key="donate-impact-title">Our Impact</h2>
            <div class="stats-grid" id="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="total-donations">0</div>
                    <div class="stat-label">Total Donations</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="total-amount">KES 0</div>
                    <div class="stat-label">Funds Raised</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="active-projects">0</div>
                    <div class="stat-label">Active Projects</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="beneficiaries">0</div>
                    <div class="stat-label">People Helped</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p class="editable" data-key="footer-text">&copy; 2026 Ajelo Foundation. All rights reserved. </p>
        </div>
    </footer>

    <!-- Configuration -->
    <script src="../js/page-config.js"></script>

    <!-- Core Services -->
    <script src="../js/services/api.service.js"></script>
    <script src="../js/admin-auth-service.js"></script>

    <!-- Feature Modules -->
    <script src="../js/content-manager.js"></script>
    <script src="../js/image-manager.js"></script>

    <!-- UI Controllers -->
    <script src="../js/admin-ui.js"></script>
    <script src="../js/admin-content-editor.js"></script>
    <script src="../js/image-uploader-ui.js"></script>

    <!-- Page Specific Script -->
    <script>
        // Simple form handling
        const form = document.getElementById('donation-form');
        const typeRadios = document.getElementsByName('donationType');

        // Toggle fields based on type
        typeRadios.forEach(radio => {
            radio.addEventListener('change', (e) => {
                const type = e.target.value;
                document.getElementById('amount-group').classList.toggle('hidden', type !== 'CASH');
                document.getElementById('item-group').classList.toggle('hidden', type !== 'ITEM');
                document.getElementById('service-group').classList.toggle('hidden', type !== 'SERVICE');
            });
        });

        // Handle submit
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('submit-btn');
            const originalText = btn.textContent;

            try {
                btn.disabled = true;
                btn.textContent = 'Processing...';

                const formData = new FormData(e.target);
                const data = Object.fromEntries(formData.entries());

                // Submit via publicAPI
                await publicAPI.submitDonation(data);

                // Show success
                document.querySelector('.form-card').style.display = 'none';
                document.getElementById('success-card').style.display = 'block';

            } catch (error) {
                alert('Donation failed: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = originalText;
            }
        });

        // Load projects for dropdown
        async function loadProjects() {
            try {
                const projects = await publicAPI.getProjects();
                const select = document.getElementById('project');
                projects.forEach(p => {
                    if (p.status === 'ONGOING') {
                        const option = document.createElement('option');
                        option.value = p.id;
                        option.textContent = p.name;
                        select.appendChild(option);
                    }
                });
            } catch (e) {
                console.error('Failed to load projects', e);
            }
        }

        document.addEventListener('DOMContentLoaded', loadProjects);
    </script>
</body>
</html>