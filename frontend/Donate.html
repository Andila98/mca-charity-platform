<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Donate - Ajelo Foundation</title>
    <link rel="stylesheet" href="Donate.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

    <!-- Header -->
    <header>
        <div class="container">
            <div class="logo" onclick="location.href='index.html'" style="cursor: pointer;">üè• Ajelo Foundation</div>
            <nav>
                <a href="index.html">Home</a>
                <a href="about us.html">About us</a>
                <a href="Impact.html">Impact</a>
                <a href="Get Involved.html">Get Involved</a>
                <a href="events.html">Events</a>
                <a href="Volunteer.html">Volunteer</a>
                <a href="Donate.html" class="btn btn-primary">Donate Now</a>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <h1>Make a Donation</h1>
            <p>Your generosity directly funds medical assistance for those in need. Every donation saves lives.</p>
        </div>
    </section>

    <!-- Donation Section -->
    <section class="section">
        <div class="container">
            <h2 class="section-title">Support Our Mission</h2>

            <div class="content-wrapper">
                <!-- Impact Information -->
                <div class="impact-section">
                    <h2>How Your Donation Helps</h2>

                    <div class="impact-card">
                        <h3>üíµ KES 1,000</h3>
                        <p>Medical consultation and basic diagnostics for a patient in need</p>
                    </div>

                    <div class="impact-card">
                        <h3>üíä KES 5,000</h3>
                        <p>Essential medications and treatment supplies for one month</p>
                    </div>

                    <div class="impact-card">
                        <h3>üè• KES 25,000</h3>
                        <p>Emergency care or minor surgical procedure</p>
                    </div>

                    <div class="impact-card">
                        <h3>‚ú® KES 100,000+</h3>
                        <p>Life-saving surgery or major medical intervention</p>
                    </div>
                </div>

                <!-- Donation Form -->
                <div class="form-wrapper">
                    <form id="donationForm" novalidate>
                        <!-- Donation Type -->
                        <div class="form-group">
                            <label class="required">Type of Donation</label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio" id="typeCash" name="donationType" value="CASH" checked>
                                    <label for="typeCash">Cash</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" id="typeItem" name="donationType" value="ITEM">
                                    <label for="typeItem">Item/Goods</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" id="typeService" name="donationType" value="SERVICE">
                                    <label for="typeService">Service</label>
                                </div>
                            </div>
                            <span class="error-message"></span>
                        </div>

                        <!-- Amount / Quick Select -->
                        <div class="form-group" id="amountGroup">
                            <label for="amount" class="required">Amount (KES)</label>
                            <input type="number" id="amount" name="amount" placeholder="Enter amount" min="1" step="100" required>
                            <div class="donation-presets">
                                <button type="button" class="preset-btn" onclick="setAmount(1000)">1K</button>
                                <button type="button" class="preset-btn" onclick="setAmount(5000)">5K</button>
                                <button type="button" class="preset-btn" onclick="setAmount(10000)">10K</button>
                                <button type="button" class="preset-btn" onclick="setAmount(25000)">25K</button>
                            </div>
                            <span class="error-message"></span>
                        </div>

                        <!-- Item Description (for Item/Service donations) -->
                        <div class="form-group" id="itemDescGroup" style="display: none;">
                            <label for="itemDesc">What are you donating?</label>
                            <textarea id="itemDesc" name="itemDescription" placeholder="E.g., Medical supplies, volunteer hours, equipment..."></textarea>
                        </div>

                        <!-- Donor Info -->
                        <div class="form-group">
                            <label for="donorName" class="required">Your Full Name</label>
                            <input type="text" id="donorName" name="donorName" placeholder="John Doe" required>
                            <span class="error-message"></span>
                        </div>

                        <div class="form-group">
                            <label for="donorEmail" class="required">Email Address</label>
                            <input type="email" id="donorEmail" name="donorEmail" placeholder="john@example.com" required>
                            <span class="error-message"></span>
                        </div>

                        <div class="form-group">
                            <label for="donorPhone" class="required">Phone Number</label>
                            <input type="tel" id="donorPhone" name="donorPhone" placeholder="+254 712 345 678" required>
                            <span class="error-message"></span>
                        </div>

                        <div class="form-group">
                            <label for="donorWard">Your Ward/Location</label>
                            <input type="text" id="donorWard" name="donorWard" placeholder="e.g., Kibra, Nairobi">
                        </div>

                        <!-- Project Selection -->
                        <div class="form-group">
                            <label for="projectSelect">Support a Specific Project (Optional)</label>
                            <select id="projectSelect" name="project_id">
                                <option value="">General Fund - Help Where Most Needed</option>
                            </select>
                            <p class="form-hint">Leave blank to support our general fund</p>
                        </div>

                        <button type="submit" class="btn-submit" id="submitBtn">
                            Process Donation
                        </button>
                    </form>

                    <div class="success-message" id="successMessage">
                        <div class="success-icon">‚úÖ</div>
                        <h3>Thank You for Your Generosity!</h3>
                        <p>Your donation has been recorded successfully.</p>
                        <p>We'll send you a receipt and impact updates via email.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <p>&copy; 2026 Ajelo Foundation. Compassion in Action.</p>
        </div>
    </footer>

    <script>
        const API_BASE = 'http://localhost:8080/api';
        const form = document.getElementById('donationForm');
        const successMessage = document.getElementById('successMessage');
        const submitBtn = document.getElementById('submitBtn');
        const amountInput = document.getElementById('amount');
        const itemDescGroup = document.getElementById('itemDescGroup');
        const donationTypeRadios = document.querySelectorAll('input[name="donationType"]');

        async function fetchAPI(endpoint, options = {}) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }

                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
                throw error;
            }
        }

        // Update URL parameter if project ID passed
        function getProjectIdFromURL() {
            const params = new URLSearchParams(window.location.search);
            return params.get('project');
        }

        async function loadProjects() {
            try {
                const projects = await fetchAPI('/v1/projects');
                const select = document.getElementById('projectSelect');
                
                projects.forEach(project => {
                    const option = document.createElement('option');
                    option.value = project.id;
                    option.textContent = project.name;
                    select.appendChild(option);
                });

                // Set project if passed in URL
                const projectId = getProjectIdFromURL();
                if (projectId) {
                    select.value = projectId;
                }
            } catch (error) {
                console.error('Failed to load projects:', error);
            }
        }

        // Handle donation type change
        donationTypeRadios.forEach(radio => {
            radio.addEventListener('change', () => {
                const isNonCash = radio.value !== 'CASH';
                itemDescGroup.style.display = isNonCash ? 'block' : 'none';
                
                if (isNonCash) {
                    amountInput.required = false;
                    document.querySelector('#amountGroup label').classList.remove('required');
                } else {
                    amountInput.required = true;
                    document.querySelector('#amountGroup label').classList.add('required');
                }
            });
        });

        // Preset amount buttons
        function setAmount(value) {
            amountInput.value = value;
            
            // Visual feedback
            document.querySelectorAll('.preset-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.classList.add('selected');
        }

        function clearErrors() {
            form.querySelectorAll('.error-message').forEach(el => el.textContent = '');
        }

        function setError(fieldId, message) {
            const field = document.getElementById(fieldId);
            const errorEl = field.nextElementSibling;
            if (errorEl && errorEl.classList.contains('error-message')) {
                errorEl.textContent = message;
            }
        }

        function validateForm() {
            clearErrors();
            let isValid = true;

            const donationType = document.querySelector('input[name="donationType"]:checked').value;
            const amount = parseFloat(amountInput.value);
            const itemDesc = document.getElementById('itemDesc').value.trim();

            if (donationType === 'CASH' && (!amount || amount < 1)) {
                setError('amount', 'Please enter a valid donation amount');
                isValid = false;
            }

            if (donationType !== 'CASH' && !itemDesc) {
                const errorEl = itemDescGroup.querySelector('.error-message') || 
                               document.createElement('span');
                errorEl.textContent = 'Please describe what you\'re donating';
                if (!itemDescGroup.querySelector('.error-message')) {
                    itemDescGroup.appendChild(errorEl);
                }
                isValid = false;
            }

            const donorName = document.getElementById('donorName').value.trim();
            if (!donorName) {
                setError('donorName', 'Please enter your full name');
                isValid = false;
            }

            const donorEmail = document.getElementById('donorEmail').value.trim();
            if (!donorEmail) {
                setError('donorEmail', 'Please enter your email address');
                isValid = false;
            } else if (!/^\S+@\S+\.\S+$/.test(donorEmail)) {
                setError('donorEmail', 'Please enter a valid email address');
                isValid = false;
            }

            const donorPhone = document.getElementById('donorPhone').value.trim();
            if (!donorPhone) {
                setError('donorPhone', 'Please enter your phone number');
                isValid = false;
            } else if (donorPhone.replace(/\D/g, '').length < 9) {
                setError('donorPhone', 'Please enter a valid phone number');
                isValid = false;
            }

            return isValid;
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            if (!validateForm()) {
                return;
            }

            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="loading-spinner"></span>Processing...';

            try {
                const donationType = document.querySelector('input[name="donationType"]:checked').value;
                const donorName = document.getElementById('donorName').value.trim();
                const donorEmail = document.getElementById('donorEmail').value.trim();
                const donorPhone = document.getElementById('donorPhone').value.trim();
                const donorWard = document.getElementById('donorWard').value.trim();
                const amount = parseFloat(document.getElementById('amount').value) || 0;
                const itemDescription = document.getElementById('itemDesc').value.trim();
                const projectId = document.getElementById('projectSelect').value || null;

                const response = await fetchAPI('/v1/donations', {
                    method: 'POST',
                    body: JSON.stringify({
                        donationType,
                        donorName,
                        donorEmail,
                        donorPhone,
                        donorWard,
                        amount,
                        itemDescription,
                        project_id: projectId
                    })
                });

                form.style.display = 'none';
                successMessage.classList.add('show');

                // Scroll to success message
                successMessage.scrollIntoView({ behavior: 'smooth' });

            } catch (error) {
                console.error('Submission error:', error);
                alert('There was an error processing your donation. Please try again.');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Process Donation';
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', loadProjects);
    </script>
</body>
</html>